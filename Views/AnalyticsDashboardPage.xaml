<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="NovelBook.Views.AnalyticsDashboardPage"
             Title="Analytics Dashboard"
             BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#121212}">

    <ScrollView>
        <VerticalStackLayout Padding="15" Spacing="15">

            <!-- ========== HEADER ========== -->
            <Frame BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#1E1E1E}"
                   CornerRadius="15"
                   Padding="20"
                   HasShadow="False">
                <Grid ColumnDefinitions="Auto,*,Auto" RowDefinitions="Auto,Auto">
                    <!-- Icono -->
                    <Label Grid.Column="0" 
                           Text="ðŸ“Š" 
                           FontSize="40"
                           VerticalOptions="Center"/>

                    <!-- TÃ­tulo y subtÃ­tulo -->
                    <VerticalStackLayout Grid.Column="1" Margin="15,0,0,0" VerticalOptions="Center">
                        <Label Text="MÃ³dulo de Analytics"
                               FontSize="22"
                               FontAttributes="Bold"
                               TextColor="{AppThemeBinding Light=#1A1A1A, Dark=#FFFFFF}"/>
                        <Label x:Name="LastUpdateLabel"
                               Text="Ãšltima actualizaciÃ³n: --"
                               FontSize="12"
                               TextColor="{AppThemeBinding Light=#666666, Dark=#AAAAAA}"/>
                    </VerticalStackLayout>

                    <!-- BotÃ³n actualizar -->
                    <Button Grid.Column="2"
                            Text="ðŸ”„"
                            FontSize="20"
                            BackgroundColor="{AppThemeBinding Light=#E3F2FD, Dark=#2D2D2D}"
                            TextColor="{AppThemeBinding Light=#1976D2, Dark=#64B5F6}"
                            CornerRadius="25"
                            WidthRequest="50"
                            HeightRequest="50"
                            Clicked="OnRefreshClicked"/>
                </Grid>
            </Frame>

            <!-- ========== INDICADOR DE CARGA ========== -->
            <ActivityIndicator x:Name="LoadingIndicator"
                               IsRunning="False"
                               IsVisible="False"
                               Color="{AppThemeBinding Light=#6200EE, Dark=#BB86FC}"
                               HeightRequest="50"/>

            <!-- ========== ESTADÃSTICAS GENERALES ========== -->
            <Label Text="ðŸ“ˆ EstadÃ­sticas Generales"
                   FontSize="18"
                   FontAttributes="Bold"
                   TextColor="{AppThemeBinding Light=#1A1A1A, Dark=#FFFFFF}"
                   Margin="0,10,0,5"/>

            <Grid x:Name="StatsGrid" 
                  ColumnDefinitions="*,*" 
                  RowDefinitions="Auto,Auto,Auto,Auto"
                  ColumnSpacing="10"
                  RowSpacing="10">

                <!-- Fila 1 -->
                <Frame Grid.Row="0" Grid.Column="0" Style="{StaticResource StatCardStyle}">
                    <VerticalStackLayout>
                        <Label Text="ðŸ‘¥" FontSize="24" HorizontalOptions="Center"/>
                        <Label x:Name="TotalUsersLabel" Text="0" FontSize="28" FontAttributes="Bold" 
                               HorizontalOptions="Center" TextColor="{AppThemeBinding Light=#1A1A1A, Dark=#FFFFFF}"/>
                        <Label Text="Usuarios" FontSize="12" HorizontalOptions="Center"
                               TextColor="{AppThemeBinding Light=#666666, Dark=#AAAAAA}"/>
                    </VerticalStackLayout>
                </Frame>

                <Frame Grid.Row="0" Grid.Column="1" Style="{StaticResource StatCardStyle}">
                    <VerticalStackLayout>
                        <Label Text="ðŸ“š" FontSize="24" HorizontalOptions="Center"/>
                        <Label x:Name="TotalNovelsLabel" Text="0" FontSize="28" FontAttributes="Bold" 
                               HorizontalOptions="Center" TextColor="{AppThemeBinding Light=#1A1A1A, Dark=#FFFFFF}"/>
                        <Label Text="Novelas" FontSize="12" HorizontalOptions="Center"
                               TextColor="{AppThemeBinding Light=#666666, Dark=#AAAAAA}"/>
                    </VerticalStackLayout>
                </Frame>

                <!-- Fila 2 -->
                <Frame Grid.Row="1" Grid.Column="0" Style="{StaticResource StatCardStyle}">
                    <VerticalStackLayout>
                        <Label Text="ðŸ“–" FontSize="24" HorizontalOptions="Center"/>
                        <Label x:Name="TotalChaptersLabel" Text="0" FontSize="28" FontAttributes="Bold" 
                               HorizontalOptions="Center" TextColor="{AppThemeBinding Light=#1A1A1A, Dark=#FFFFFF}"/>
                        <Label Text="CapÃ­tulos" FontSize="12" HorizontalOptions="Center"
                               TextColor="{AppThemeBinding Light=#666666, Dark=#AAAAAA}"/>
                    </VerticalStackLayout>
                </Frame>

                <Frame Grid.Row="1" Grid.Column="1" Style="{StaticResource StatCardStyle}">
                    <VerticalStackLayout>
                        <Label Text="â­" FontSize="24" HorizontalOptions="Center"/>
                        <Label x:Name="AvgRatingLabel" Text="0.0" FontSize="28" FontAttributes="Bold" 
                               HorizontalOptions="Center" TextColor="{AppThemeBinding Light=#1A1A1A, Dark=#FFFFFF}"/>
                        <Label Text="Rating Promedio" FontSize="12" HorizontalOptions="Center"
                               TextColor="{AppThemeBinding Light=#666666, Dark=#AAAAAA}"/>
                    </VerticalStackLayout>
                </Frame>

                <!-- Fila 3 -->
                <Frame Grid.Row="2" Grid.Column="0" Style="{StaticResource StatCardStyle}">
                    <VerticalStackLayout>
                        <Label Text="ðŸ“" FontSize="24" HorizontalOptions="Center"/>
                        <Label x:Name="TotalReviewsLabel" Text="0" FontSize="28" FontAttributes="Bold" 
                               HorizontalOptions="Center" TextColor="{AppThemeBinding Light=#1A1A1A, Dark=#FFFFFF}"/>
                        <Label Text="ReseÃ±as" FontSize="12" HorizontalOptions="Center"
                               TextColor="{AppThemeBinding Light=#666666, Dark=#AAAAAA}"/>
                    </VerticalStackLayout>
                </Frame>

                <Frame Grid.Row="2" Grid.Column="1" Style="{StaticResource StatCardStyle}">
                    <VerticalStackLayout>
                        <Label Text="ðŸ“‰" FontSize="24" HorizontalOptions="Center"/>
                        <Label x:Name="AbandonmentRateLabel" Text="0%" FontSize="28" FontAttributes="Bold" 
                               HorizontalOptions="Center" TextColor="{AppThemeBinding Light=#1A1A1A, Dark=#FFFFFF}"/>
                        <Label Text="Tasa Abandono" FontSize="12" HorizontalOptions="Center"
                               TextColor="{AppThemeBinding Light=#666666, Dark=#AAAAAA}"/>
                    </VerticalStackLayout>
                </Frame>

                <!-- Fila 4 -->
                <Frame Grid.Row="3" Grid.Column="0" Style="{StaticResource StatCardStyle}">
                    <VerticalStackLayout>
                        <Label Text="ðŸ”¥" FontSize="24" HorizontalOptions="Center"/>
                        <Label x:Name="ActiveUsersLabel" Text="0" FontSize="28" FontAttributes="Bold" 
                               HorizontalOptions="Center" TextColor="{AppThemeBinding Light=#1A1A1A, Dark=#FFFFFF}"/>
                        <Label Text="Usuarios Activos" FontSize="12" HorizontalOptions="Center"
                               TextColor="{AppThemeBinding Light=#666666, Dark=#AAAAAA}"/>
                    </VerticalStackLayout>
                </Frame>

                <Frame Grid.Row="3" Grid.Column="1" Style="{StaticResource StatCardStyle}">
                    <VerticalStackLayout>
                        <Label Text="ðŸ·ï¸" FontSize="24" HorizontalOptions="Center"/>
                        <Label x:Name="TotalGenresLabel" Text="0" FontSize="28" FontAttributes="Bold" 
                               HorizontalOptions="Center" TextColor="{AppThemeBinding Light=#1A1A1A, Dark=#FFFFFF}"/>
                        <Label Text="GÃ©neros" FontSize="12" HorizontalOptions="Center"
                               TextColor="{AppThemeBinding Light=#666666, Dark=#AAAAAA}"/>
                    </VerticalStackLayout>
                </Frame>
            </Grid>

            <!-- ========== RECOMENDACIONES ========== -->
            <Grid ColumnDefinitions="*,Auto" Margin="0,20,0,5">
                <Label Text="ðŸ’¡ Recomendaciones Inteligentes"
                       FontSize="18"
                       FontAttributes="Bold"
                       TextColor="{AppThemeBinding Light=#1A1A1A, Dark=#FFFFFF}"/>
                <Button Grid.Column="1"
                        Text="Generar"
                        FontSize="12"
                        BackgroundColor="#6200EE"
                        TextColor="White"
                        CornerRadius="15"
                        Padding="15,5"
                        Clicked="OnGenerateRecommendationsClicked"/>
            </Grid>

            <!-- PestaÃ±as de filtro de recomendaciones -->
            <Grid ColumnDefinitions="*,*,*" ColumnSpacing="10" Margin="0,10,0,10">
                <Button x:Name="PendingTabButton"
                        Text="Pendientes"
                        FontSize="12"
                        BackgroundColor="#6200EE"
                        TextColor="White"
                        CornerRadius="10"
                        Clicked="OnRecommendationTabClicked"/>
                <Button x:Name="ReadTabButton"
                        Grid.Column="1"
                        Text="LeÃ­das"
                        FontSize="12"
                        BackgroundColor="{AppThemeBinding Light=#E0E0E0, Dark=#2D2D2D}"
                        TextColor="{AppThemeBinding Light=#666666, Dark=#AAAAAA}"
                        CornerRadius="10"
                        Clicked="OnRecommendationTabClicked"/>
                <Button x:Name="ImplementedTabButton"
                        Grid.Column="2"
                        Text="Implementadas"
                        FontSize="12"
                        BackgroundColor="{AppThemeBinding Light=#E0E0E0, Dark=#2D2D2D}"
                        TextColor="{AppThemeBinding Light=#666666, Dark=#AAAAAA}"
                        CornerRadius="10"
                        Clicked="OnRecommendationTabClicked"/>
            </Grid>

            <!-- Contador y botÃ³n limpiar -->
            <Grid ColumnDefinitions="*,Auto" Margin="0,0,0,5">
                <Label x:Name="RecommendationCountLabel"
                       Text="0 recomendaciones"
                       FontSize="12"
                       TextColor="{AppThemeBinding Light=#666666, Dark=#AAAAAA}"
                       VerticalOptions="Center"/>
                <Button Grid.Column="1"
                        x:Name="ClearRecommendationsButton"
                        Text="ðŸ—‘ï¸ Limpiar"
                        FontSize="11"
                        BackgroundColor="{AppThemeBinding Light=#FFEBEE, Dark=#3D2020}"
                        TextColor="{AppThemeBinding Light=#D32F2F, Dark=#EF5350}"
                        CornerRadius="10"
                        Padding="10,5"
                        Clicked="OnClearRecommendationsClicked"/>
            </Grid>

            <!-- Contenedor de recomendaciones -->
            <VerticalStackLayout x:Name="RecommendationsContainer" Spacing="10">
                <!-- Se llena dinÃ¡micamente -->
                <Frame BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#1E1E1E}"
                       CornerRadius="10"
                       Padding="15"
                       HasShadow="False">
                    <Label Text="Presiona 'Generar' para analizar datos y obtener recomendaciones..."
                           TextColor="{AppThemeBinding Light=#666666, Dark=#AAAAAA}"
                           HorizontalOptions="Center"/>
                </Frame>
            </VerticalStackLayout>

            <!-- ========== TOP NOVELAS ========== -->
            <Label Text="ðŸ† Top 5 Novelas MÃ¡s LeÃ­das"
                   FontSize="18"
                   FontAttributes="Bold"
                   TextColor="{AppThemeBinding Light=#1A1A1A, Dark=#FFFFFF}"
                   Margin="0,20,0,5"/>

            <VerticalStackLayout x:Name="TopNovelsContainer" Spacing="10">
                <!-- Se llena dinÃ¡micamente -->
                <Frame BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#1E1E1E}"
                       CornerRadius="10"
                       Padding="15"
                       HasShadow="False">
                    <Label Text="Cargando novelas..."
                           TextColor="{AppThemeBinding Light=#666666, Dark=#AAAAAA}"
                           HorizontalOptions="Center"/>
                </Frame>
            </VerticalStackLayout>

            <!-- ========== TOP GÃ‰NEROS ========== -->
            <Label Text="ðŸ”¥ GÃ©neros MÃ¡s Populares"
                   FontSize="18"
                   FontAttributes="Bold"
                   TextColor="{AppThemeBinding Light=#1A1A1A, Dark=#FFFFFF}"
                   Margin="0,20,0,5"/>

            <VerticalStackLayout x:Name="TopGenresContainer" Spacing="10">
                <!-- Se llena dinÃ¡micamente -->
                <Frame BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#1E1E1E}"
                       CornerRadius="10"
                       Padding="15"
                       HasShadow="False">
                    <Label Text="Cargando gÃ©neros..."
                           TextColor="{AppThemeBinding Light=#666666, Dark=#AAAAAA}"
                           HorizontalOptions="Center"/>
                </Frame>
            </VerticalStackLayout>

            <!-- ========== TOP AUTORES ========== -->
            <Label Text="âœï¸ Autores con Mejor Engagement"
                   FontSize="18"
                   FontAttributes="Bold"
                   TextColor="{AppThemeBinding Light=#1A1A1A, Dark=#FFFFFF}"
                   Margin="0,20,0,5"/>

            <VerticalStackLayout x:Name="TopAuthorsContainer" Spacing="10">
                <!-- Se llena dinÃ¡micamente -->
                <Frame BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#1E1E1E}"
                       CornerRadius="10"
                       Padding="15"
                       HasShadow="False">
                    <Label Text="Cargando autores..."
                           TextColor="{AppThemeBinding Light=#666666, Dark=#AAAAAA}"
                           HorizontalOptions="Center"/>
                </Frame>
            </VerticalStackLayout>

            <!-- ========== ETIQUETAS POPULARES ========== -->
            <Label Text="ðŸ·ï¸ Etiquetas Populares"
                   FontSize="18"
                   FontAttributes="Bold"
                   TextColor="{AppThemeBinding Light=#1A1A1A, Dark=#FFFFFF}"
                   Margin="0,20,0,10"/>

            <FlexLayout x:Name="PopularTagsLayout"
                        Wrap="Wrap"
                        Direction="Row"
                        JustifyContent="Start"
                        AlignItems="Start">
                <!-- Se llena dinÃ¡micamente -->
            </FlexLayout>

            <!-- ========== PATRONES ========== -->
            <Grid ColumnDefinitions="*,Auto" Margin="0,20,0,5">
                <Label Text="ðŸ” Patrones Identificados"
                       FontSize="18"
                       FontAttributes="Bold"
                       TextColor="{AppThemeBinding Light=#1A1A1A, Dark=#FFFFFF}"/>
                <Button Grid.Column="1"
                        Text="ðŸ—‘ï¸ Limpiar"
                        FontSize="11"
                        BackgroundColor="{AppThemeBinding Light=#FFEBEE, Dark=#3D2020}"
                        TextColor="{AppThemeBinding Light=#D32F2F, Dark=#EF5350}"
                        CornerRadius="10"
                        Padding="10,5"
                        Clicked="OnClearPatternsClicked"/>
            </Grid>

            <!-- Contador de patrones -->
            <Label x:Name="PatternsCountLabel"
                   Text="0 patrones identificados"
                   FontSize="12"
                   TextColor="{AppThemeBinding Light=#666666, Dark=#AAAAAA}"
                   Margin="0,0,0,5"/>

            <!-- Contenedor de patrones (mÃ¡ximo 6) -->
            <VerticalStackLayout x:Name="PatternsContainer" Spacing="8">
                <Frame BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#1E1E1E}"
                       CornerRadius="10"
                       Padding="15"
                       HasShadow="False">
                    <Label Text="Los patrones se generarÃ¡n al presionar 'Generar' en recomendaciones..."
                           TextColor="{AppThemeBinding Light=#666666, Dark=#AAAAAA}"
                           HorizontalOptions="Center"
                           FontSize="12"/>
                </Frame>
            </VerticalStackLayout>

            <!-- Espacio final -->
            <BoxView HeightRequest="30"/>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>