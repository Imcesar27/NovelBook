<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="NovelBook.Views.HistoryPage"
             Title="Historial"
             BackgroundColor="{StaticResource BackgroundDark}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header con estadÃ­sticas -->
        <Frame Grid.Row="0"
               BackgroundColor="{StaticResource BackgroundMedium}"
               CornerRadius="0"
               Padding="20"
               Margin="0,0,0,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- CapÃ­tulos leÃ­dos -->
                <VerticalStackLayout Grid.Column="0" HorizontalOptions="Center">
                    <Label Text="156"
                           FontSize="24"
                           FontAttributes="Bold"
                           TextColor="{StaticResource Primary}"
                           HorizontalTextAlignment="Center"/>
                    <Label Text="CapÃ­tulos"
                           FontSize="12"
                           TextColor="{StaticResource TextSecondary}"
                           HorizontalTextAlignment="Center"/>
                </VerticalStackLayout>

                <!-- Tiempo de lectura -->
                <VerticalStackLayout Grid.Column="1" HorizontalOptions="Center">
                    <Label Text="48h"
                           FontSize="24"
                           FontAttributes="Bold"
                           TextColor="{StaticResource Primary}"
                           HorizontalTextAlignment="Center"/>
                    <Label Text="Tiempo total"
                           FontSize="12"
                           TextColor="{StaticResource TextSecondary}"
                           HorizontalTextAlignment="Center"/>
                </VerticalStackLayout>

                <!-- Racha de lectura -->
                <VerticalStackLayout Grid.Column="2" HorizontalOptions="Center">
                    <Label Text="7"
                           FontSize="24"
                           FontAttributes="Bold"
                           TextColor="{StaticResource Primary}"
                           HorizontalTextAlignment="Center"/>
                    <Label Text="DÃ­as seguidos"
                           FontSize="12"
                           TextColor="{StaticResource TextSecondary}"
                           HorizontalTextAlignment="Center"/>
                </VerticalStackLayout>
            </Grid>
        </Frame>

        <!-- Filtros de tiempo -->
        <ScrollView Grid.Row="1" 
                    Orientation="Horizontal"
                    Padding="10,0"
                    HeightRequest="50">
            <HorizontalStackLayout Spacing="10">
                <Button Text="Hoy"
                        BackgroundColor="{StaticResource Primary}"
                        TextColor="White"
                        CornerRadius="15"
                        Padding="20,5"
                        Clicked="OnFilterClicked"
                        CommandParameter="Today"/>
                <Button Text="Ayer"
                        BackgroundColor="{StaticResource BackgroundMedium}"
                        TextColor="{StaticResource TextSecondary}"
                        CornerRadius="15"
                        Padding="20,5"
                        Clicked="OnFilterClicked"
                        CommandParameter="Yesterday"/>
                <Button Text="Esta semana"
                        BackgroundColor="{StaticResource BackgroundMedium}"
                        TextColor="{StaticResource TextSecondary}"
                        CornerRadius="15"
                        Padding="20,5"
                        Clicked="OnFilterClicked"
                        CommandParameter="ThisWeek"/>
                <Button Text="Este mes"
                        BackgroundColor="{StaticResource BackgroundMedium}"
                        TextColor="{StaticResource TextSecondary}"
                        CornerRadius="15"
                        Padding="20,5"
                        Clicked="OnFilterClicked"
                        CommandParameter="ThisMonth"/>
                <Button Text="Todo"
                        BackgroundColor="{StaticResource BackgroundMedium}"
                        TextColor="{StaticResource TextSecondary}"
                        CornerRadius="15"
                        Padding="20,5"
                        Clicked="OnFilterClicked"
                        CommandParameter="All"/>
            </HorizontalStackLayout>
        </ScrollView>

        <!-- Lista de historial -->
        <ScrollView Grid.Row="2" Padding="10">
            <CollectionView x:Name="HistoryList">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame BackgroundColor="{StaticResource BackgroundMedium}"
                               CornerRadius="10"
                               Padding="15"
                               Margin="0,5">
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnHistoryItemTapped"/>
                            </Frame.GestureRecognizers>

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="60"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Imagen de la novela -->
                                <Frame Grid.Column="0"
                                       CornerRadius="5"
                                       Padding="0"
                                       BackgroundColor="{StaticResource BackgroundLight}"
                                       HeightRequest="60"
                                       WidthRequest="60">
                                    <Image Source="{Binding CoverImage}"
                                           Aspect="AspectFill"/>
                                </Frame>

                                <!-- InformaciÃ³n -->
                                <VerticalStackLayout Grid.Column="1" 
                                                   Padding="10,0,0,0"
                                                   VerticalOptions="Center">
                                    <Label Text="{Binding NovelTitle}"
                                           TextColor="{StaticResource TextPrimary}"
                                           FontSize="14"
                                           FontAttributes="Bold"
                                           LineBreakMode="TailTruncation"/>
                                    <Label Text="{Binding ChapterTitle}"
                                           TextColor="{StaticResource TextSecondary}"
                                           FontSize="12"
                                           LineBreakMode="TailTruncation"/>
                                    <HorizontalStackLayout Spacing="10">
                                        <Label TextColor="{StaticResource TextMuted}"
                                               FontSize="11">
                                            <Label.FormattedText>
                                                <FormattedString>
                                                    <Span Text="ðŸ“– " FontSize="10"/>
                                                    <Span Text="{Binding ReadingProgress}"/>
                                                </FormattedString>
                                            </Label.FormattedText>
                                        </Label>
                                        <Label TextColor="{StaticResource TextMuted}"
                                               FontSize="11">
                                            <Label.FormattedText>
                                                <FormattedString>
                                                    <Span Text="â±ï¸ " FontSize="10"/>
                                                    <Span Text="{Binding ReadingTime}"/>
                                                </FormattedString>
                                            </Label.FormattedText>
                                        </Label>
                                    </HorizontalStackLayout>
                                </VerticalStackLayout>

                                <!-- Hora -->
                                <Label Grid.Column="2"
                                       Text="{Binding TimeAgo}"
                                       TextColor="{StaticResource TextMuted}"
                                       FontSize="11"
                                       VerticalOptions="Start"/>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </ScrollView>

        <!-- Estado vacÃ­o -->
        <VerticalStackLayout x:Name="EmptyState"
                           Grid.Row="2"
                           VerticalOptions="Center"
                           HorizontalOptions="Center"
                           Spacing="20"
                           IsVisible="False">
            <Label Text="ðŸ“š"
                   FontSize="60"
                   HorizontalOptions="Center"/>
            <Label Text="No hay historial de lectura"
                   TextColor="{StaticResource TextSecondary}"
                   FontSize="16"
                   HorizontalOptions="Center"/>
            <Button Text="Explorar novelas"
                    BackgroundColor="{StaticResource Primary}"
                    TextColor="White"
                    CornerRadius="20"
                    Padding="20,10"
                    Clicked="OnExploreClicked"/>
        </VerticalStackLayout>
    </Grid>
</ContentPage>