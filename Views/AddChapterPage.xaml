<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="NovelBook.Views.AddChapterPage"
             Title="Agregar CapÃ­tulo"
             BackgroundColor="{StaticResource BackgroundDark}">

    <ScrollView>
        <VerticalStackLayout Spacing="20" Padding="20">

            <!-- InformaciÃ³n de la novela -->
            <Frame BackgroundColor="{StaticResource BackgroundMedium}"
                   CornerRadius="10"
                   Padding="15">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="60"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Image x:Name="NovelCover"
                           WidthRequest="60"
                           HeightRequest="80"
                           Aspect="AspectFill"/>

                    <VerticalStackLayout Grid.Column="1" 
                                       Padding="10,0,0,0"
                                       VerticalOptions="Center">
                        <Label x:Name="NovelTitle"
                               FontSize="16"
                               FontAttributes="Bold"
                               TextColor="{StaticResource TextPrimary}"/>
                        <Label x:Name="ChapterInfo"
                               FontSize="12"
                               TextColor="{StaticResource TextSecondary}"/>
                    </VerticalStackLayout>
                </Grid>
            </Frame>

            <!-- InformaciÃ³n del capÃ­tulo -->
            <Frame BackgroundColor="{StaticResource BackgroundMedium}"
                   CornerRadius="10"
                   Padding="20">
                <VerticalStackLayout Spacing="15">
                    <Label Text="InformaciÃ³n del CapÃ­tulo"
                           FontSize="18"
                           FontAttributes="Bold"
                           TextColor="{StaticResource TextPrimary}"/>

                    <!-- NÃºmero de capÃ­tulo -->
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <Label Text="CapÃ­tulo #"
                               TextColor="{StaticResource TextPrimary}"
                               VerticalOptions="Center"
                               WidthRequest="100"/>

                        <Entry x:Name="ChapterNumberEntry"
                               Grid.Column="1"
                               Keyboard="Numeric"
                               TextColor="{StaticResource TextPrimary}"
                               BackgroundColor="{StaticResource BackgroundLight}"/>
                    </Grid>

                    <!-- TÃ­tulo del capÃ­tulo -->
                    <VerticalStackLayout Spacing="5">
                        <Label Text="TÃ­tulo del CapÃ­tulo *"
                               TextColor="{StaticResource TextPrimary}"/>
                        <Entry x:Name="ChapterTitleEntry"
                               Placeholder="Ej: El comienzo de todo"
                               PlaceholderColor="{StaticResource TextMuted}"
                               TextColor="{StaticResource TextPrimary}"
                               BackgroundColor="{StaticResource BackgroundLight}"/>
                    </VerticalStackLayout>
                </VerticalStackLayout>
            </Frame>

            <!-- Editor de contenido mejorado -->
            <Frame BackgroundColor="{StaticResource BackgroundMedium}"
                   CornerRadius="10"
                   Padding="20">
                <VerticalStackLayout Spacing="15">
                    <Label Text="Contenido del CapÃ­tulo *"
                           FontSize="18"
                           FontAttributes="Bold"
                           TextColor="{StaticResource TextPrimary}"/>

                    <!-- Barra de herramientas de formato expandida -->
                    <ScrollView Orientation="Horizontal" HeightRequest="50">
                        <HorizontalStackLayout Spacing="5">
                            <!-- Formato bÃ¡sico -->
                            <Button Text="B"
                                    FontAttributes="Bold"
                                    BackgroundColor="{StaticResource BackgroundLight}"
                                    TextColor="{StaticResource TextPrimary}"
                                    WidthRequest="40"
                                    HeightRequest="40"
                                    CornerRadius="5"
                                    ToolTipProperties.Text="Negrita"
                                    Clicked="OnBoldClicked"/>

                            <Button Text="I"
                                    FontAttributes="Italic"
                                    BackgroundColor="{StaticResource BackgroundLight}"
                                    TextColor="{StaticResource TextPrimary}"
                                    WidthRequest="40"
                                    HeightRequest="40"
                                    CornerRadius="5"
                                    ToolTipProperties.Text="Cursiva"
                                    Clicked="OnItalicClicked"/>

                            <Button Text="UÌ²"
                                    BackgroundColor="{StaticResource BackgroundLight}"
                                    TextColor="{StaticResource TextPrimary}"
                                    WidthRequest="40"
                                    HeightRequest="40"
                                    CornerRadius="5"
                                    ToolTipProperties.Text="Subrayado"
                                    Clicked="OnUnderlineClicked"/>

                            <!-- Separador visual -->
                            <BoxView WidthRequest="1"
                                     HeightRequest="30"
                                     BackgroundColor="{StaticResource TextSecondary}"
                                     VerticalOptions="Center"/>

                            <!-- AlineaciÃ³n -->
                            <Button Text="â¬…"
                                    BackgroundColor="{StaticResource BackgroundLight}"
                                    TextColor="{StaticResource TextPrimary}"
                                    WidthRequest="40"
                                    HeightRequest="40"
                                    CornerRadius="5"
                                    ToolTipProperties.Text="Alinear izquierda"
                                    Clicked="OnAlignLeftClicked"/>

                            <Button Text="â¬Œ"
                                    BackgroundColor="{StaticResource BackgroundLight}"
                                    TextColor="{StaticResource TextPrimary}"
                                    WidthRequest="40"
                                    HeightRequest="40"
                                    CornerRadius="5"
                                    ToolTipProperties.Text="Centrar"
                                    Clicked="OnAlignCenterClicked"/>

                            <Button Text="âž¡"
                                    BackgroundColor="{StaticResource BackgroundLight}"
                                    TextColor="{StaticResource TextPrimary}"
                                    WidthRequest="40"
                                    HeightRequest="40"
                                    CornerRadius="5"
                                    ToolTipProperties.Text="Alinear derecha"
                                    Clicked="OnAlignRightClicked"/>

                            <!-- Separador visual -->
                            <BoxView WidthRequest="1"
                                     HeightRequest="30"
                                     BackgroundColor="{StaticResource TextSecondary}"
                                     VerticalOptions="Center"/>

                            <!-- Elementos especiales -->
                            <Button Text="â€”"
                                    BackgroundColor="{StaticResource BackgroundLight}"
                                    TextColor="{StaticResource TextPrimary}"
                                    WidthRequest="40"
                                    HeightRequest="40"
                                    CornerRadius="5"
                                    ToolTipProperties.Text="LÃ­nea divisora"
                                    Clicked="OnDividerClicked"/>

                            <Button Text="Â« Â»"
                                    BackgroundColor="{StaticResource BackgroundLight}"
                                    TextColor="{StaticResource TextPrimary}"
                                    WidthRequest="50"
                                    HeightRequest="40"
                                    CornerRadius="5"
                                    ToolTipProperties.Text="DiÃ¡logo"
                                    Clicked="OnDialogClicked"/>

                            <Button Text="..."
                                    BackgroundColor="{StaticResource BackgroundLight}"
                                    TextColor="{StaticResource TextPrimary}"
                                    WidthRequest="40"
                                    HeightRequest="40"
                                    CornerRadius="5"
                                    ToolTipProperties.Text="Puntos suspensivos"
                                    Clicked="OnEllipsisClicked"/>

                            <!-- Separador visual -->
                            <BoxView WidthRequest="1"
                                     HeightRequest="30"
                                     BackgroundColor="{StaticResource TextSecondary}"
                                     VerticalOptions="Center"/>

                            <!-- Herramientas adicionales -->
                            <Button Text="Â¶"
                                    BackgroundColor="{StaticResource BackgroundLight}"
                                    TextColor="{StaticResource TextPrimary}"
                                    WidthRequest="40"
                                    HeightRequest="40"
                                    CornerRadius="5"
                                    ToolTipProperties.Text="Nuevo pÃ¡rrafo"
                                    Clicked="OnParagraphClicked"/>

                            <Button Text="ðŸ’­"
                                    BackgroundColor="{StaticResource BackgroundLight}"
                                    TextColor="{StaticResource TextPrimary}"
                                    WidthRequest="40"
                                    HeightRequest="40"
                                    CornerRadius="5"
                                    ToolTipProperties.Text="Pensamiento"
                                    Clicked="OnThoughtClicked"/>

                            <Button Text="âš¡"
                                    BackgroundColor="{StaticResource BackgroundLight}"
                                    TextColor="{StaticResource TextPrimary}"
                                    WidthRequest="40"
                                    HeightRequest="40"
                                    CornerRadius="5"
                                    ToolTipProperties.Text="AcciÃ³n"
                                    Clicked="OnActionClicked"/>
                        </HorizontalStackLayout>
                    </ScrollView>

                    <!-- Editor de texto grande -->
                    <Editor x:Name="ContentEditor"
                            Placeholder="Escribe el contenido del capÃ­tulo aquÃ­..."
                            PlaceholderColor="{StaticResource TextMuted}"
                            TextColor="{StaticResource TextPrimary}"
                            BackgroundColor="{StaticResource BackgroundLight}"
                            HeightRequest="500"
                            AutoSize="TextChanges"
                            TextChanged="OnContentTextChanged"
                            FontSize="16"/>

                    <!-- Contador de palabras y caracteres -->
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <Label x:Name="WordCountLabel"
                               Text="0 palabras"
                               TextColor="{StaticResource TextMuted}"
                               FontSize="12"
                               HorizontalOptions="Start"/>

                        <Label x:Name="CharCountLabel"
                               Grid.Column="1"
                               Text="0 caracteres"
                               TextColor="{StaticResource TextMuted}"
                               FontSize="12"
                               HorizontalOptions="Center"/>

                        <Label x:Name="AutoSaveLabel"
                               Grid.Column="2"
                               Text="Borrador automÃ¡tico"
                               TextColor="{StaticResource TextMuted}"
                               FontSize="12"
                               HorizontalOptions="End"/>
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- Vista previa con formato -->
            <Frame BackgroundColor="{StaticResource BackgroundMedium}"
                   CornerRadius="10"
                   Padding="20">
                <VerticalStackLayout Spacing="10">
                    <HorizontalStackLayout>
                        <Label Text="Vista Previa"
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="{StaticResource TextPrimary}"
                               HorizontalOptions="StartAndExpand"/>
                        <Switch x:Name="PreviewSwitch"
                                OnColor="{StaticResource Primary}"
                                Toggled="OnPreviewToggled"/>
                    </HorizontalStackLayout>

                    <Frame x:Name="PreviewFrame"
                           BackgroundColor="{StaticResource BackgroundLight}"
                           CornerRadius="5"
                           Padding="15"
                           IsVisible="False"
                           HeightRequest="300">
                        <ScrollView>
                            <Label x:Name="PreviewLabel"
                                   TextColor="{StaticResource TextPrimary}"
                                   LineHeight="1.8"
                                   FontSize="16"/>
                        </ScrollView>
                    </Frame>
                </VerticalStackLayout>
            </Frame>

            <!-- Botones de acciÃ³n -->
            <Grid ColumnSpacing="10" Margin="0,0,0,20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Button Grid.Column="0"
                        Text="Cancelar"
                        BackgroundColor="{StaticResource BackgroundMedium}"
                        TextColor="{StaticResource TextPrimary}"
                        CornerRadius="10"
                        HeightRequest="50"
                        Clicked="OnCancelClicked"/>

                <Button Grid.Column="1"
                        x:Name="SaveDraftButton"
                        Text="Guardar Borrador"
                        BackgroundColor="{StaticResource Secondary}"
                        TextColor="White"
                        CornerRadius="10"
                        HeightRequest="50"
                        Clicked="OnSaveDraftClicked"/>

                <Button Grid.Column="2"
                        x:Name="PublishButton"
                        Text="Publicar CapÃ­tulo"
                        BackgroundColor="{StaticResource Primary}"
                        TextColor="White"
                        CornerRadius="10"
                        HeightRequest="50"
                        FontAttributes="Bold"
                        Clicked="OnPublishClicked"/>
            </Grid>

            <!-- Indicador de carga -->
            <ActivityIndicator x:Name="LoadingIndicator"
                              Color="{StaticResource Primary}"
                              IsVisible="False"
                              Margin="0,20,0,0"/>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>